variant: flatcar
version: 1.0.0

passwd:
  users:
    - name: &user core
      ssh_authorized_keys:
        - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICiUB1MgFciQ63LsGGBwHVjCtf1cn50BdxN9jTtfTPGF rize@legion


storage:
  directories:
    - path: /etc/traefik
      mode:
      user:
        name: *user
      group:
        name: *user
    - path: /etc/letsencrypt
      mode:
      user:
        name: *user
      group:
        name: *user

  # from docs: Ensure docker starts automatically
  links:
    - path: /etc/systemd/system/multi-user.target.wants/docker.service
      target: /usr/lib/systemd/system/docker.service
      hard: false
      overwrite: true

  files:
    - path: /etc/traefik/file-provider.yaml
      contents:
        local: file-provider.yaml
      mode: 0644
      user:
        name: *user
      group:
        name: *user
    - path: /etc/traefik/traefik.yaml
      contents:
        local: traefik.yaml
      mode: 0644
      user:
        name: *user
      group:
        name: *user
    - path: /etc/systemd/system/traefik.service
      contents:
        local: traefik.service
      user:
        name: root
      group:
        name: root

systemd:
  units:
    - name: docker.service
      enabled: true